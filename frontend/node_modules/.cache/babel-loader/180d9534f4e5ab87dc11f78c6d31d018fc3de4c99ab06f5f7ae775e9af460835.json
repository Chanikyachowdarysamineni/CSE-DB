{"ast":null,"code":"// Helper function to broadcast new content notifications\n// This should be called after successfully creating content in any module\n\nexport const broadcastContentNotification = (contentType, contentData, userRole) => {\n  // Only broadcast if posted by Faculty, HOD, or DEAN\n  if (!['Faculty', 'HOD', 'DEAN'].includes(userRole)) {\n    return;\n  }\n\n  // Create notification event\n  const notification = {\n    title: `New ${contentType} Posted`,\n    message: `${contentData.title || contentData.name}: ${(contentData.body || contentData.description || '').substring(0, 100)}...`,\n    type: contentType.toLowerCase(),\n    priority: contentData.priority || 'medium',\n    itemId: contentData.id,\n    timestamp: new Date().toISOString(),\n    channel: 'In-app',\n    read: false\n  };\n\n  // Broadcast to all students via localStorage event\n  const event = new CustomEvent('newContentPosted', {\n    detail: notification\n  });\n  window.dispatchEvent(event);\n\n  // Also store in a temporary broadcast storage that other tabs can read\n  const broadcasts = JSON.parse(localStorage.getItem('contentBroadcasts') || '[]');\n  broadcasts.push(notification);\n\n  // Keep only last 50 broadcasts\n  if (broadcasts.length > 50) {\n    broadcasts.shift();\n  }\n  localStorage.setItem('contentBroadcasts', JSON.stringify(broadcasts));\n\n  // Trigger storage event for other tabs\n  window.dispatchEvent(new Event('storage'));\n  return notification;\n};\n\n// Listen for broadcasts in NotificationContext\nexport const setupBroadcastListener = addNotification => {\n  const handleNewContent = event => {\n    if (event.detail) {\n      addNotification(event.detail);\n    }\n  };\n  const handleStorageChange = () => {\n    const broadcasts = JSON.parse(localStorage.getItem('contentBroadcasts') || '[]');\n    const lastBroadcast = broadcasts[broadcasts.length - 1];\n    if (lastBroadcast) {\n      // Check if we've already seen this broadcast\n      const lastSeen = localStorage.getItem('lastSeenBroadcast');\n      const broadcastTime = new Date(lastBroadcast.timestamp).getTime();\n      if (!lastSeen || broadcastTime > parseInt(lastSeen)) {\n        addNotification(lastBroadcast);\n        localStorage.setItem('lastSeenBroadcast', broadcastTime.toString());\n      }\n    }\n  };\n  window.addEventListener('newContentPosted', handleNewContent);\n  window.addEventListener('storage', handleStorageChange);\n  return () => {\n    window.removeEventListener('newContentPosted', handleNewContent);\n    window.removeEventListener('storage', handleStorageChange);\n  };\n};","map":{"version":3,"names":["broadcastContentNotification","contentType","contentData","userRole","includes","notification","title","message","name","body","description","substring","type","toLowerCase","priority","itemId","id","timestamp","Date","toISOString","channel","read","event","CustomEvent","detail","window","dispatchEvent","broadcasts","JSON","parse","localStorage","getItem","push","length","shift","setItem","stringify","Event","setupBroadcastListener","addNotification","handleNewContent","handleStorageChange","lastBroadcast","lastSeen","broadcastTime","getTime","parseInt","toString","addEventListener","removeEventListener"],"sources":["D:/documents/Desktop/CSE-DB/frontend/src/utils/notificationBroadcast.js"],"sourcesContent":["// Helper function to broadcast new content notifications\r\n// This should be called after successfully creating content in any module\r\n\r\nexport const broadcastContentNotification = (contentType, contentData, userRole) => {\r\n  // Only broadcast if posted by Faculty, HOD, or DEAN\r\n  if (!['Faculty', 'HOD', 'DEAN'].includes(userRole)) {\r\n    return;\r\n  }\r\n\r\n  // Create notification event\r\n  const notification = {\r\n    title: `New ${contentType} Posted`,\r\n    message: `${contentData.title || contentData.name}: ${(contentData.body || contentData.description || '').substring(0, 100)}...`,\r\n    type: contentType.toLowerCase(),\r\n    priority: contentData.priority || 'medium',\r\n    itemId: contentData.id,\r\n    timestamp: new Date().toISOString(),\r\n    channel: 'In-app',\r\n    read: false\r\n  };\r\n\r\n  // Broadcast to all students via localStorage event\r\n  const event = new CustomEvent('newContentPosted', {\r\n    detail: notification\r\n  });\r\n  \r\n  window.dispatchEvent(event);\r\n\r\n  // Also store in a temporary broadcast storage that other tabs can read\r\n  const broadcasts = JSON.parse(localStorage.getItem('contentBroadcasts') || '[]');\r\n  broadcasts.push(notification);\r\n  \r\n  // Keep only last 50 broadcasts\r\n  if (broadcasts.length > 50) {\r\n    broadcasts.shift();\r\n  }\r\n  \r\n  localStorage.setItem('contentBroadcasts', JSON.stringify(broadcasts));\r\n  \r\n  // Trigger storage event for other tabs\r\n  window.dispatchEvent(new Event('storage'));\r\n\r\n  return notification;\r\n};\r\n\r\n// Listen for broadcasts in NotificationContext\r\nexport const setupBroadcastListener = (addNotification) => {\r\n  const handleNewContent = (event) => {\r\n    if (event.detail) {\r\n      addNotification(event.detail);\r\n    }\r\n  };\r\n\r\n  const handleStorageChange = () => {\r\n    const broadcasts = JSON.parse(localStorage.getItem('contentBroadcasts') || '[]');\r\n    const lastBroadcast = broadcasts[broadcasts.length - 1];\r\n    \r\n    if (lastBroadcast) {\r\n      // Check if we've already seen this broadcast\r\n      const lastSeen = localStorage.getItem('lastSeenBroadcast');\r\n      const broadcastTime = new Date(lastBroadcast.timestamp).getTime();\r\n      \r\n      if (!lastSeen || broadcastTime > parseInt(lastSeen)) {\r\n        addNotification(lastBroadcast);\r\n        localStorage.setItem('lastSeenBroadcast', broadcastTime.toString());\r\n      }\r\n    }\r\n  };\r\n\r\n  window.addEventListener('newContentPosted', handleNewContent);\r\n  window.addEventListener('storage', handleStorageChange);\r\n\r\n  return () => {\r\n    window.removeEventListener('newContentPosted', handleNewContent);\r\n    window.removeEventListener('storage', handleStorageChange);\r\n  };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}